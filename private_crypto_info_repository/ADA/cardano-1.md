**Ouroboros: 一个可证明安全的POS区块链协议**

Aggelos Kiayias*  Alexander Russell†  Bernardo David‡  Roman Oliynykov§

2017年8月21日

**摘要**

我们提出“Ouroboros”，第一个基于POS的带有严格的安全保证的区块链协议。相比通过bitcoin区块链协议完成的，我们为协议建立了安全的性能。因为协议提供了POS区块链纪律。相比基于物理资源证明的区块链（e.g, POW）,它提供了质的效率优势。我们也提出了一个新奇的用于激励POS协议的奖励机制，并且我们证明，考虑到这个机制，诚实的行为是一个近似的纳什均衡，使得像利己主义的挖矿无效。我们也通过提供在交易确认和处理的实验结果，来提出我们协议在真实世界设置下的初始的证据。

**1. 介绍**

关于基于POW的区块链协议-比如Bitcoin-操作的主要的考虑是执行所需要的能量。在写作的时间里，在bitcoin区块链上生成单个区块需要超过260此的哈希操作，会导致侵袭能源需求。实际上，早期的流通现实协议的能量需求比得上一个小国家。

事情的状态激发人们研究可以通过用其他能源效率更高的另外一个方式替代他，来避免需要POW替代的区块链协议,机制也能提供相似的保证。很重要的是要之处bitcoin的POW机制促进了一种类型的随机“领导人选择”过程，选择其中一个矿工去发行下一个区块。而且，如果所有的矿工都遵循这个协议，这个选择是以和每个矿工算例称比例的随机方式执行的。（来自这个协议的误差可能成比例的扭曲，由“自私的挖矿”策略例证）

一个自然的替代机制依赖于PoS的概念。不是矿工投资矿工为了参与领导选择过程，而是他们运行一个过程，随机的选择他们中的一个，和股份成比例的，每个过程根据当前区块链账簿。

实际上，这产生了自指的区块链纪律：维护区块链依赖于利益相关者自己，基于账簿中所报告的每个过程的质量的数量来给他们安排工作（和奖励）。除了这个之外，这个纪律部需要对利益相关者进行进一步的“人造的”计算需求。在某种意义上，这个听上去很理想；但是意思到这样的PoS协议显得涉及到许多定义上的，技术的和分析的挑战。

**先前的工作** PoS概念在bitcoin论坛曾被广泛的讨论。基于PoS的区块链涉及层被Bentov et al更加正式的研究国，既在和PoW连接方面，也在作为区块链协议单独的机制。尽管Bentovet al.展示了针对一些种类的攻击他们的协议是有效的，他们没提供一个正式的依赖精确的定义的模型，用于分析基于PoS的协议或安全证明。对于许多加密货币，探索性的基于PoS的协议被提出（和实施）。基于探索性的安全论证，这些加密货币并频繁的发现从安全的观点上是有缺陷的。参照【4】作为一个各种攻击的讨论。

对于一个基于PoS的区块链协议与一个依赖固定权威这集合的经典的共识区块链也是很有意思的。区分基于PoS的区块链协议与那些假设静态的当局这的是抵押随着时间变化，因此信任假设随着系统进化。

另外一个PoW的替代是空间证明的概念，在区块链协议的背景下被特别的研究。在一个空间证明设置里，一个“证人”希望证明对空间的使用（存储/内存）；正如在PoW的情况，这个使用了物理资源，但是随着时间需要的能量少一些。一个相关的概念是空间-时间证明（PoST）。在所有的这些情况，但是一个昂贵的物理资源（存储或算力）是必要的

**PoS设计挑战** 对于基于PoS的区块链协议的基础的问题是去模拟领导选择过程。为了在利益相关者中达到一个公平的随机的选择，熵必须引入到系统力，引入熵的机制可能易于被对手操纵。例如，一个控制足足利益相关者的对手可能尝试模拟协议执行，尝试利益相关者参与者的不同的序列。这样找到一个有利于对手的利益相关者的协议附加部分。这会导致所谓的“无休止的”弱点，对手方可能用计算资源去倾斜领导者选择。

**我们的结果** 我们提出“Ouroboros”，一个可证明的安全的PoS系统。据我们所知，这是第一个有严格的安全分析的这种类型的区块链协议。更详细的，我们的结果如下。

第一，我们提供了一个模型，是的认识到基于PoS区块链协议的这个问题正式化。我们介绍的这个模型是本着 一个健壮的交易账簿的两个正式的性能，集中于持续和活跃性的精神。持续表述一旦系统的一个声明一个特定的交易为“稳定的”，剩下的节点，如果诚实的询问和回应，也会将起报告为“稳定的”。此时，稳定性被理解为一个谓语，由一些安全参数k表示，将影响确定性，那个性质保持。（例如，超过k阻止深处）。活跃性确保，一旦真诚的生成的交易可以实现为一个充足的时间足够的数量到网络节点，比如u时间步数，将会是稳定的。活跃性和持续性的结合提供了一个健壮的账簿，从某种意义上说，生成的交易被采用，并且变得不可变的。我们的模型适宜的被修改去促进基于PoS的动力学。

第二，我们描述了一个基于PoS的新奇的区块链协议。我们的协议假定当事人可以自由的创建账户和接受和支付，那个质押随着时间转换。我们使用一个（非常简单的）安全的掷硬币协议的的多党实施去生成领导选择过程的随机性。区分我们的方式（和阻止所谓的“无休止攻击”）和其他之前的解决方式是价值确定的基于区块链的当前状态或使用共同的掷硬币作为引入熵的方式。并且，对我们的方式是独特的是系统忽略循环到循环的质押修改。反而，会定时利益相关者的当前集合进行定期快照，间隔被称作"epochs";在每个这样的间隔里，会进行一个而安全的多党的计算，使用区块链本身作为广播渠道。特别地，在每个时间点上，一组从委员会随机选择出来的利益相关者，然后负责执行掷硬币协议。协议的结果决定在一个时间点执行协议的下一组利益相关者，和所有领导选择的结果一样，用于时间点。

第三，我们提供一组正式的自变数，确立没有对手方可以打破持续和活跃性。在一些看似可信的假设下，我们的协议是安全的:(1)网络是同步的，从某种意义上来说，一个上限可以被决定，在任何诚实的利益相关者可以和任何其他利益相关者沟通，(2)一些从诚实的多数中提取的一些利益相关者是可能的，当需要参与每个间隔时,(3)利益相关者不会长时段的保持离线，（4）腐败自适应从属于一个小的延迟，在轮线性衡量，在安全的参数（或替代的，选手可以访问一个发送者匿名的广播渠道）。在我们安全参数的核心是该类型的参数，根据一个组合的概念“可分叉的线”，我们规划，证明，并且也用实验方法验证。在我们的分析里，我们也区分转换共i，一种一般分叉攻击的特别种类。这里的“转换性”本着转换跌收，针对安全多党的计算协议的精神，敌方像打破这个协议，但是更喜欢不被抓到做这个。我们展示秘密地分叉串是带有更小密度的分叉串的子类；这允许我们提供两个由区别的安全参数，完成不同的折中，依照效率和安全保障。我们分叉的串分析是一个自然的，相当的普遍的工具，可以被作为PoS设置的安全参数的一部分应用。

第四，我们把我们的注意力转移到协议的激励结构。我们展示一个新的奖励机制，用于激励这个系统的参与这，我们证明起（近似于）纳什均衡。在这个方式，攻击像区块阻挡和自私挖矿会被我们的设计减轻。奖励机制背后的核心理念是去提供积极的报酬给协议行动，不能被从协议中分叉的参与方的联合扼杀。在这个方式下，可能展示这个，在貌似可信的假设下，也记忆是一定的协议执行诚实是小的，忠诚的遵循协议是一个均衡，当所有的选手是理性的。

第五，我们引入了质押委托机制，可以无缝的加入到我们区块链协议。委托是非常有用的，在我们的内容中，当我们允许协议去扩展，甚至在一种设置里，一组利益相关者是高度分裂的。在这样的情况下，委托机制使得利益相关者去委托他们的“投票权”，例如，在每个时间点参与运行领导选择协议委员会的权利。在流动性民主，（亦称，委托的民主），利益相关者由能力撤回委托任命，当他们想相互独立。

考虑到我们模型和协议描述，我们也探索可在实际中多种多样的攻击，在我们的框架内被解决。特别的，我们讨论了双花攻击，交易拒绝攻击，51%攻击，没有质押，去同步化攻击和其他。最后，我们展示了冠以我们涉及的效率的证据。第一我们考虑双花攻击。为了说明目的，我们和中本聪关于bitcoin的分析进行了一个对比，关于带有确认99.9%的交易确认时间。反对转换敌手，交易确认时间比bitcoin快10到16倍，依赖于敌对的哈希算例；对于一般的敌手确认时间，有5到10倍快。而且，我们对于双花攻击的具体分析依赖于我们的分叉和密密地分叉串的组合，并且应用到一个更加广阔敌对行为的种类，相比中本聪的更加简化的分析。我们然后调查了我们的原型实施和在Amazon云计算上进行的基准测试的报告，可以展示我们的PoS区块链协议的力量 ，依照性能。

**相关工作** 与开发我们的Ouroboros同步，一些其他协议也真被开发，用来针对多种位置，在基于PoS的分布式账簿的设计空间里。睡眠的共识认为一个固定的利益相关者分布（例如，质押不会随着时间进化），目标为一个“混合的”腐败设置，敌手被允许去适应和执行失败终止，除了拜占庭错误恢复腐败。这个实际上简单的扩展到偶们在混合的腐败设置里的分析，cf.备注2；然而，结果的安全可以被争论，仅仅在“带延迟的腐败”的设置，因此不是完全的可适应的。雪白提出了一个进化的利益相关者分布，并且采用了我们争论安全类似的腐败延迟机制。然而，与我们协议相反，雪白设计已受“无休止的”类型的攻击影响，可以偏向对敌对方有利的高可能性事件。当这个不是渐近地上海安全，它阻止了一个具体的参数化，不会考虑敌对的算例。Algorand提供了一个遵循拜占庭协议的分布式账簿，每个区块的方式，抵挡住适应的腐败。考虑到协议需要到达每个区块，这样的协议会以一个实质上比PoS区块链慢的速率生产区块。（慢下来和拜占庭同意协议的执行的期望长度），但是他们可以自由的分叉。在这方面，尽快存在分叉，区块链协议展示了允许客户去设置他们愿意承受的风险等级的灵活性，允许低风险侧面客户享受更快的处理事件，从乐观的角度。最后，Fruitchain提供了一个奖励机制和一个近似的纳什均衡证明，对于基于PoW的区块链。我们在区块链层面用了一个类似的奖励机制，虽然我们基础的结构是不同的，因为需要在PoS设置下操作。这个思想的核心是提供一个“背书”输入的POS类似，在一个公平的比例，适用相同的逻辑正如基于PoW的拜占庭同意协议，用于诚实的大多数所来的。

**白皮书综述** 我们在Sec. 2展示基本的模型。为了简化我们协议的分以，我们在我们的四个阶段展示它，被在Sec. 3中概述。总之，在Sec. 4,我们描述和分析了协议，在静态设置；我们然后再Sec. 5中过渡到动态设置。我们的激励机制和均衡参数再Sec. 7中展示。我们然后在Sec. 6中展示带有匿名渠道的协议增加，在Sec. 8中带有一个委托机制。随后，在Sec. 9中，我们讨论了在各种各样特别的利益攻击下的，在协议的恢复力。在Sec. 10,我们讨论国盾确认次数，和一般的执行结果，从在Amazon云上运行的原型实施的结果。

**2. 模型**

**时间，位置和同步** 我们考虑一个设置，时间被划分为被称作位置的不连续的单元。一个账簿，如下进行更详细的描述，一个账簿区块和每个时间位置有管（至多）。选手被装备（大概同步的）时钟，展示当前的位置。这讲允许他们实施一个分布式协议，目的是共同的布置一个区块到当前位置。总之，每个位置slr由整数r 2 {1, 2, . . .}做索引，我们假设对应每个位置的实时窗口有如下性质。

- 当前位置是有公开已知的，单调的当前时间增加函数决定的
- 每个选手可以访问当前时间。当事人本地时间之间的相差，相比由slot代表的时间长度是无关紧要的。
- 对应一个位置的时间窗口长度是足够去保证人后在时间窗口开始的时候由诚实参与者传送的信息将会在时间窗口结束时，由任何其他诚实的参与方收到（甚至对在参与方的当地时钟中的小的不一致负责）。特别，当网络延迟发生，他们从来不会超过位置的时间窗口。

**交易账簿性质** 一个协议实施了一个健壮的交易账簿，如果2维持的账簿被划分为“区块”（分配给时间位置），决定交易被包含到账簿里的顺序。它应该满足如下两个性质。

**持续** 一旦系统的一个节点宣告一个特定的交易tx作为稳定的，剩下的节点，如果查询，会在账簿的相同位置报告tx,或不会把任何和tx冲突的交易报告未稳定的，这里稳定性的概念是一个谓语，用安全参数k作为参数来表示；特别地，一个交易被声明未稳定，如果并且仅仅，如果在一个区块里，在账簿里超过k区块深。

**活跃性** 如果在系统中的所有的诚实的节点尝试去包含一个特定的交易，那么在对应u位置的时间过去后（被称为交易确认时间），所有的节点，如果诚实地查询和回复，将会将交易报告为稳定的

在[26， 35]，它被展示：持续和活跃性可以来源于如下三个基本的性质，如果协议2来源于账簿，从一个区块链形式的数据结构。

- **一般的前缀（CP）;带参数** k 2 N.链由两个诚实的参与人控制，在位置sl1 < sl2的开始，是Cdk
  1  C2,Cdk表示这个链，通过从C1移除最后的k区块获得，并且表示前缀关系。

- **链质量（CQ）;带参数** μ 2 (0, 1] 和 ` 2 N。考虑长度的任何部分，至少链的 ，由诚实的参与方控制，在循环的开始；由敌对方引起的区块比例至多是1−μ.我们称μ为链质量系数。
- **链增长（CG）;带参数**  2 (0, 1], s 2 N.考虑链C1, C2，由两个诚实的参与方控制，在两个位置sl1, sl2的开始，带有sl2,至少在sl1前面。然后它持有len(C2) − len(C1)   · s. 我们称为速度系数

一些注意在这些地方。关于一般前缀，我们多的一个一般前缀的强概念。cf. [26].关于链质量，μ,作为敌对方的比例的函数，满足μ()  ，对于利益协议。在一个理想的设置里，μ会是1−；在这个情况下，恶意区块的比例，在任何足够长的的链部分，和一组（恶意的）利益相关者的累积的质押是成比例的。

值得注意对于bitcoin,我们由μ() = (1 − 2)/(1 − ),这个限制事实上是紧的，参照[24]，争论链质量的保证。同样的会保持正确，对于协议建设。正如我们展示，这将足够，对于我们用于合适地工作的激励机制。

最后，链增长涉及到链增长的速度（对于诚实的节点）。在bitcoin的情况下，最长的链在我们协议里扮演优先的作用；这提供链增长的一个简单的保证。

**安全模型** 我们采用由[24]引入的模型，用于分析区块链协议的安全性，由理想的功能f增强。我们通过VIEWP,F
,A,Z()表示P参与方的观点，在协议2执行后，带有敌对方A，环境Z，安全参数和访问理想的功能f。类似的，我们用EXECP,F
,A,Z()表示Z的输出。

我们注意到多个不同的“功能会被f完成。与[24]相反，我们的分析是在“标准模型里”，不带由一个而随机的预言机功能，我们在理想的功能里包含的第一个界面，在协议里适用的是“传播”和“关键的和交易”功能，以FD+KT命名，会在下面描述。注意传播的功能也是机制，通过我们将获得协议的同步性。

**传播功能** 传播功能包制一个进来的字符串，对于参与的每个参与方Ui。一个参与方，如果激活，是被在任何时刻允许去取得他们进入的字符串；可能会把这个想象称一个信箱。此外，参与方会知道功能去传播一个小小，在一种情况，信息会被添加到每个参与方的进入的字符串。这个功能保持循环（地点），并且所有参与方在一个循环里传播一次。循环不前进，除非所有参与方已经传播了一个消息。敌对方，当激活后，可能也和这个功能互动，它被允许去阅读所有收件箱，和所有的传播要求，并且以它喜欢的任何顺序投递信息到收件箱里。在循环结束后，这个功能会确保包含素偶又信息的收件箱被出阿伯（但是不是必要，以相同的顺序，他们被要求被传播的）。当前的地点参数可能在任何时间由任何参与方要求。如果一个利益相关方没有取得一个特定的地点，这个信息写入到他的进入的字符串，他们会被暴露。

**关键的和交易功能** 关键登记功能是带有n个用户，U1, . . . ,Un进行初始化，和他们各自的质押s1,...,sn;考虑到这样的初始化，函数会和敌方商议，会接受一个（可能空的）（腐败的，U）信息的序列，并且标记对应的用户U作为腐败。对于在函数里登记的不带有公钥的腐败的用户，将允许敌方去设置他呢的公钥，当对于诚实的用户，这个函数会抽样取样公/私钥对，并且基于数字前面算法记录他们。腐败用户的公钥会被标记称这样。随后，如下行动的任何序列可能会发生：（i）一个用户可能要求减少它的公钥和私钥，因此这个函数会将其返回给用户。(ii)公钥的全部的目录会被要求，因此这个函数会将其返回给请求的用户。(iii)一个新用户可能被要求被创立，通过一个来自环境的消息（Create,U,C）,函数将遵循如之前的相同的步骤：它将会和敌对方商量，关于U的腐败状态，并且会设置其公开，可能私钥依赖于腐败状态；此外，它将会储存C，作为建议的初始状态。函数会根据交互作用的成功完成返回公钥到环境里。(iv)一个现行的用户可能被要求去被腐败，通过敌对方，通过一个消息（Corrupt,U）。一个用户能仅被腐化，在D位置的延迟后；特别的，一个腐败请求是登记的私钥，会被释放，在D位置已经通过，根据循环计数器，在函数出阿伯的部件重维持。

考虑到上述，我们会假设协议的执行是关于函数F，吸收了上述两个函数，和可能的额外的函数，在如下被解释的。注意一个腐败的利益相关者U会让渡它所有的状态到A；从现在开始，敌方会被激活，代替利益相关者U。超出F利用的任何限制，敌方仅仅能腐败一个利益相关者，如果是通过环境Z运行协议执行的给定的许可。许可时以消息的形式（Corrupt, U）,会通过环境被提供给敌方。总之，关于激活，我们有如下。

- 在美俄个位置Slj，环境Z被运去去精活利益相关者期望的任何子集。他们中的 每个人可能生成信息，可以被传送给其他利益相关者
- 敌方至少被激活，作为最后实体，在每个slj，（和在所有敌对方激活一样）

很容易看到以上模型在敌方上授予这样的规模打大的权利，一个能不能在利益协议上建立任何重大的保证。隐私去限制环境的适宜的（考虑协议的详情），因此我们个能争论安全性。没有元年，我们在环境上世家的限制如下：

**施加到环境的限制** 环境，负责在每一个循环激活诚实的节点，将从属于如下约束，关于运行协议的诚实节点的激活

- 在每个位置，会至少有一个诚实的激活的参与方
- 将有一个参数k 2 Z，将会表示位置的最大数，一个诚实的利益相关者会离线。假使一个诚实的利益相关者被生成，在协议的开始，通过由环境提供的它的初始化的链C，应该匹配一个诚实的参与方的链，在之前的位置是活跃的。
- 在每一个位置Slr.对于每个活跃的利益相关者Uj，会是一组公钥和形式(vki, si) 2 {0, 1} × N, for j = 1, . . . , nr的质押对，nr是这个引入的用户数，到那个位置，会代表谁是活跃的参与这，按照Uj的观点。公钥会被标记为“腐败的”，如果对于的利益相关者被腐败的。我们会说敌方会被限制小于50%的相关质押，如果它包制由总计的质押划分的腐败钥匙的总的质押小于在所有的可能的Sj(r)的50%。假使上述被事件Bad1/2违背的，对于给定的执行成为正确的。

我们注意到上述陈述的离线的限制是非常保守的，我们的协议可以容忍更长的离线事件，取决于窒息感步骤的过程的方式；然而，对于简易质押，我们使用上述限制。最终，我们注意到在我们的证明里，无论何时，我们说一个性质Q保持在所有执行上高的可能性。这捕获了这个事实，我们排除环境和敌方，触发带有不可忽视的可能性的Bad1/2。

**3. 我们的协议： 综述**

我们首先提供一个我们协议设计方式的大概的综述。这个协议的特性取决于一些如下参数：(i) k是区块数，应该由在其之上，为了成为账簿的不可变的历史的一部分，(ii)是优势，依照诚实的利益相关者的质押，针对敌对方(iii)D是腐败延迟，在敌对方上施加，例如，一个诚实的利益相关者将会被腐败，在D位置后，当一个腐败信心在执行期间由敌方传递；(iv)L是系统的寿命，在位置里衡量；（v）R是事件点的长度，在位置中衡量。

我们展示我们的协议描述，在相继的四阶段，提供它所能抵挡的敌方的模型。在所有的阶段里，一个“理想的功能”，对于参与者是可行的。函数捕获了资源，在所有参与方中作为前提存在，用对协议的安全的操作（例如，创世块会由指定）

**阶段 1：静态质押** D= L。在第一阶段，信任假设是静态的，并带有利用相关者初始集保持。由一个初始的质押分布， 会被硬编码进创世块，包含利益相关者{(vki, si)}ni
=1.的公钥。基于我们对环境的限制，带有优点的诚实的大多数假定在这些初始的利益相关者中。特别的，环境初始地会允许一些利益相关者的腐败，它的相关质押表示1−用于一些 > 0.环境允许通过提供形式（Corrupt, U)的tokens到敌对方去允许参与方腐败；注意由于在第一阶段事实的腐败延迟，任何进一步的腐败会反对参与方，最初没有质押，因此腐败模型和“静态腐败类似的”。FD,F将随后取样p,会播种一个“由质押重量”的利益相关者取样，在这个放肆导致m keys vki1 , . . . , vkim的子集的选择，到形成一个委员会，会控制待在m带有压倒性可能性的诚实的大多数，（这用了事实，由恶意参与方控制的相关质押是1−
2），m到的现行依赖会被施加在这个阶段）。更详细的，委员会将会被含蓄的选择，通过指定利益相关者，带有可能性，和它的质押成比例，对L位置的每个人。随后，利益相关者讲法发行区块，遵循这个计划表，由slot作业决定。最长链规则会被应用，对于敌对方是可能去分叉区块链视角，诚实方。然而，我们将证明，带有一个Markov链论证，可能性，一个分叉可能被维持，在一个n位置的序列，以指数方式降低，至少p
n, cf.定理4.12针对一般敌对者。一个更加喜欢的反省可以针对转变敌对方所做的。例子，更喜欢保持“在雷达下的”定理4.23.

**阶段2： 动态的状态，带有一个灯塔，R位置的时间点期间，**D = R  L. 以上协议的寿命的扩展的中心思想是去考虑他的若干调用的相继的构成，我们详述一个做这个方法，在这样的假设下，一个可信任的灯塔定期发出一个一致的随机字符串。更具体的说，这个灯塔，在位置{j ·R+1, . . . , (j+1)R},现实j-th随机字符喜欢，播种领导选择函数。和静态状态协议相比的决定性的不同是质押分布被允许去该白，是从区块链自身得到的。这意味着一个特定的位置sl,属于j-th时间点（带j  2），被使用的质押分布是在最近区块链里报告的，带有小于j · R − 2k.的时间戳。

关于进化的质押分布，交易会被持续的生成和传送，通过环境在利益相关者之间，选手会包含被同胞的交易在基于他们维护的账簿的区块链。为了适应被创建的新的账户，函数使得一个新的(vk, sk)即期被创建，并安排给一个新的参与方Ui.特别的，环境会创建一个新的参与方，会和相互作用，为了他们的公/私钥，在一个方式，将其作为一个可信任的部件去对待，维护他们钱包的秘密。注意，敌对方可以妨碍一个新的参与方的创建，腐败他，提供他自己的（敌对创建的）公钥替代。如以前，环境，可能要求在来自利益相关者的，账户之间的交易，他能生成交易，和敌方勾结。为了腐败的账户。回忆：我们的假设是，在任何位置，按照诚实的选手的观点，利益相关者分布满足诚实的大多数，带有优点（注意不同的诚实的选手可能理解一个不同的利益相关者分布，在一个特定的位置）。而且，质押能够转换，通过至多统计距离，通过特定数量的位置。这里被衡量的统计距离考虑基础的分布，作为更具质押获得权重的采样器，以及他瑞华随着规定的时间间隔改变。安全证明可以被看做一个感应现象，在时间点L/R的数量，带有基础情况，由静态的质押协议的证明提供。最后，我们会讨论在这个设置里，一个限制，在敌对的之压力，对安全是最后的，一个单个的抽签（观察委员会的尺寸，m,现在应该被选择去克服，也一个累计的属于，尺寸ln(L/R)，考虑到系统的寿命，包含这样一个连续点的时间）。腐败延迟保持在D = R，可以被选择任意小于L的，因此使得敌对方去执行适应的腐败，只要这不是即时的。

**阶段3 动态的状态，不带有灯塔，R位置的时间点阶段R = (k)和延迟D 2 (R, 2R)  L.**在第三个阶段，我们移除了对于灯塔的从属，通过引入一个安全的多方协议，带有一个“保证的输出传递”，模拟他。在这个方式，我们可以获得长活跃性，如阶段2描述的设计，不仅仅在阶段1设计的假设下，例如，这仅有的一个初始化随机字符串的可能性，和一个带有诚实大多数的初始化利益相关者分布。核心思想如下：考虑到我们保证，在选择的利益相关者中诚实的大多数将保持非常高的可能性，我们能进一步的使用选择的设置作为参与者，到一个安全的多方的计算协议的实例。这将要求时间点的长度的选择会是充足的，所以可以容纳MPC协议的运行。从安全的角度来看，和前面的情况主要的不同是，灯塔的输出会被敌对方知道，在被诚实参与方知道之前。然后，我们会证明诚实参与方也会不可避免的知道它，在较少的位置后。为了对这个事实进行解释，敌方抢先了（可能由执行适合的腐败开发），我们增加等待时间，用于腐败，从R到一个合适的值在(R, 2R)，否定这个优点，依赖安全的MPC设计。从加密设计角度看，这个节点的特点是，账簿本身的使用，对于一个可靠的传播的模拟 ，支持MPC协议。

**阶段4 输入背书人，利益相关者委托，匿名通信** 在我们设计的第一个阶段，我们增加了这个协议，带有两个新的任务，为实体，运行协议和考虑匿名通信的好处。输入背书人创建了一个交易的第二层，先于区块包含背书。这个机制使得这个协议可以抵挡误差，比如利己的挖矿，和使得我可以去展示诚实的行为是一个近似的纳什均衡，在合理的假设下，关于运行协议的成本。注意输入背书者被分配给位置，以相同的方法，一些位置领导是，并且被包含在区块里的输入仅仅可接受，如果他们由一个合格的输入背书者背书。第二，授权特点允许利益相关者去转移委员会参与给被选择的委托，假定在运行协议里的利益相关者的责任（包括参与到MPC和区块的发布）。委托自然的引起“质押池”，能够以相同的方式行动，正如bitcoin中的矿池。最后，我们我们观察到，通过包含一个匿名通信的层，我们可以移除腐败延迟要求，在我们分析中被利用的。这个以对于诚实参与方增加在线时间要求为代价。

**4 我们的协议：静态状态**

**4.1 基本的概念和协议描述**

我们通过在“静态质押”设置里描述区块链协议开始，领导会被分给给区块链位置，带有可能性，和他们（固定的）初始的质押成比例，是有效的质押分布，通过执行。为了简化我们的描述，我们抽象化领导选择处理，将其简单的对待为一个“理想的功能”，如实的执行随机分配利益相关者给位置的过程。在如下的章节，我们解释如何距离说明这个功能，带有特定的安全计算。

我们注意到，甚至带有一个而理想的领导分配过程--分析标准“最长链”优先权规则，在我们的PoS的设定中，变得需要重要的新注意。产生这个挑战是因为许多位置（时间点，如上所述）被立刻分配给利益相关者；当这个有有利的性质，从一个效率（和激励）角度，它给敌对方提供了一个新奇的攻击方式。特别地，一个控制特定利益相关者人口的敌对方能够，在一个时间点的开始，选择，当标准“链更新”广播消息被传递给诚实的节点，带有未来位置分配的全部知识，到利益相关者。与之相反，在典型的POW中设置中敌对方被限制去做这样的决定，在一个在线的方式。我们注意到这个有一个引人注目的效果，在敌对方生成敌对链的能力上；参在如下“分叉字符串的”讨论，用于详细的讨论。

在静态质押的情况，我们假定固定的n利益相关者u1...un的集合通过协议相互作用。利益相关者Ui用用si质押，在协议开始之前。对于每个利益相关者Ui,一个认证和签署钥对（vki, ski）对于一个规定的签名组合被生成；我们假设不损失普遍性的情况下，验证钥vk1..被所以的利益相关者知道。在描述这个协议，我们建议里基本的定义，遵循如下的概念。

**定义 4.1** (创世区块)。创世区块B0包含有他们公钥识别的利益相关者的李彪，他们分别质押（vk1,s1）....(Vkn,sn)和辅助的信息p

具有仙剑，我们注意的辅助信息P将被用作播种位置领导选择过程。

**定义 4.2**(状态)。 一个状态是一个字符串2 {0, 1}.

**定义4.3** (区块)。 一个区块在位置生成，包含当前状态，数据，位置数sli和一个前面，在SKI下计算的，对应利益相关者Ui生成区块。

**定义 4.4** （区块链）区块链（或简单地链）涉及创世块B0是一个区块B1，...Bn的序列 ，与一个严格的块的增长序列有关系，对于他和Bi的状态等于H(Bi-1),H是一个规定的康冲突的哈希函数。一个链的len(C)=n的长度是它的区块数。区块Bn是链的头，表示为head(C)。我们将空字符串看做一个合法的链，通过约定设置head=

让C成为一个长度为N的链，k是任何非负整数。我们用Ck表示链，起因于C的最右面的区块移除。如果k大于等于len(C),我们定义Ck=.我们让C1  C2表示链C1是链C2的前缀。

**定义 4.5** （时间点）。时间点是R邻近的位置S={Sl1,...SLR}的集合

（值R是协议的参数，我们在这一章节分析的）

**定义 4.6** （敌对的质押比例）。让Ua成为由敌对方控制的利益相关者的集合。那么敌对质押比例被质押为：



n是利益相关者的综述，si是利益相关者Ui的质押

**位置领导者选择** 在这一章里描述的协议中，对于每个0<j<r,一个位置领导者Ej被决定，谁由这个（唯一的）权利去在slj处生成一个区块。特别地，对于每个位置，一个利益相关者被选择为位置领导者，带有可能性pi，和他们在创世块B0中登记的它的质押成比例；这个分配在位置间是独立的。在这个静态的质押情况，创世块也成为过程，选择领导者，由理想的函数决定，在图标1中定义。这个函数由用参数表示，分配给每个利益相关者它的分别的质押，一个分布D，提供辅助的信息p和一个领导选择函数F，如下定义：

**定义 4.7** (领导者选择处理)。一个领导者选择处理，关于利益相关者分布 是一个对，由分布和确定性函数组成，比如，当p d,它保持，对于所有，输出，带有可能性。

si是由利益相关者Ui持有的质押（我们称之为根据质押的权重）；此外，随机参数的家族是独立的。

我们注意到和质押成比例取样可以被实施，以一个简单的方式。例如，一个间的处理操作如下。让。对于每个，如果没有利益相关者被选择，这个处理掷p倾向的币；如果币的结果是1，参与方Ui被选择为这个位置，这个处理被完成。（注意pn=1,所以这个过程被确定去完成，带有一个独立的梯子）。当我们实施这个过程，作为函数F.足够的随机性必须被分配去模拟有偏见的掷硬币。如果我们实施上述，带有精度，对于每个独立的掷硬币，然后选择一个利益相关者会要求随机字节，总计。注意使用一个伪随机数生成器（PRG），一个人可能用较短的“种子”字符串，然后拉伸它，使用PRG到合适的长度。
**功能**

[模式] 包含传播和私钥/交易函数，来自章节2，由公钥和最初利益相关者的分别的质押的参数确定，分布D和函数F，因此（D,F）是一个领导者选择过程。另外，是被mode的参数确定的，决定签名验证钥是如何生成的。当[模式]实例化，带有mode=SIG(resp. mode=FDSIG),被表示为（）。和利益相关者交互作用，如下：

- **签名钥对生成：** 生成签名的和验证的钥ski,vki,对于利益相关者Ui,通过执行。生成，通过查询，带有，代表Ui（带有一个唯一的会议标识符sidi,和Ui相关联），设置（ski = sidi, vki=vi）(从Fdsig接受作为回复)，对于i=1,....n.设置。

- **创世块生成**  再接受（ ），从利益相关者，如下开始。如果p还没有被设置，抽样 pd.无论如何，发送给Ui
- **签名和验证** 提供通向Fdisg界面的访问

**在模型的协议** 我们通过描述一个基于区块链协议的简单的PoS开始，考虑静态的质押，在混合的模型，例如，当创世块B0（和因此位置的领导者）被决定，由理想的函数。提供利益相关者，带有创始块，包括一个质押分布，由签名验证私钥为索引，由EUF-CMA签名组合生成，当从签名的理想函数中获得这样的钥。微妙的不同开始起作用，当描述一个理想的版本，在过渡的混合自变数使用的，安全的证明，会在章节4.2中讨论。利益相关者U1，....UM在他们自己中互相作用，带有，通过协议，在图标2中描述的。

这个协议依赖于maxvalidS(C,C)函数，选择一个链，考虑到当前的链C，和一组有效链C的，在网络中存在。在静态的情况下，简单的“最长链”规则（在动态的情况下，这个由一个普通的链长度确定参数；参照章节5）

函数maxvalid(C,C):返回最长链，从。结被打破，由利于C，如果有最大的长度，或武断地，否则。

**协议**

是一个由利益相关者U1,....Un运行的协议,和相互影响，在一系列的位置S={}处理如下：

1. **初始化** 利益相关者Ui 2 {U1, . . . ,Un，从密钥登记界面接受，它的公司钥。然后它收到当前的位置，从广播界面，假释它是SL1,它发送，到，收到作为答案。Ui设置本地区块链C = B0 = (S0, )，并且最初的内部状态。否则，它从密钥登记界面收到最初的链C，设置本地区块链到C和最初的内部状态st = H(head(C)).
2. **链扩展** 对于每个位置slj 2 S,每个利益相关者Ui执行如下步骤

(a) 收集所有的有效链，通过广播到集合C收到的，验证，对于每个链和每个链，它包制，当vk时利益相关者的验证密钥，计算=，作为新的本地链，设置状态。

(b) 如果Ui时位置领导者，由F决定的，它生成一个新的区块B=，st时它的当前状态，d时交易数据，是一个在。。商店额签名，Ui计算，广播C,设置C，作为新的本地链，设置状态。

3. **交易生成** 考虑到交易模板tx, Ui返回，如果tx按照Ui的观点和账簿的状态一致。

**4.2 理想协议的安全分析**

作为SPoS的安全分析的第一步，我们将引入一个理想化的协议iSPoS，并展示一个过渡的混合的自变数，展示从计算方面讲，和SPoS不能区分的

代替依赖FD,FLS [SIG]和一个EUF-CMA签名组合，iSPoS带有一个理想的签名组合操作。为了那个目的，iSPoS和FD,FLS [FDSIG]相互作用，为了获得签名和验证密钥，用于在协议中采用的签名的理想组合。在下面的学期中，我们会证明iSPoS是安全的，通过一系列组合的论证。我们首先展示这个混合的原因是，我们打算隔离这些组合的参数，从特定的细节，基础的签名组合，被用来举例证明SPoS和偏差，这些组合可能在SPoS的分布中结束，集中，替代理想的执行，几秒组合被完美的意识到，影响我们协议的真实属性。

**功能 Fdsig**

FDSIG按如下方式和利益相关者交互作用：

**密钥生成**  在收到来自利益相关者Ui的信息(KeyGen, sid)，为一些sid验证sid =(Ui, sid0)。如果不是，忽略这个要求。另外，将(KeyGen, sid)交给敌对放。在从敌对放收到(VerificationKey, sid, v)，输出(VerificationKey, sid, v)到Ui,记录对(Ui, v).

**签名生成** 从Ui处收到一个消息(Sign, sid,m)，为一些sid0验证sid =(Ui, sid0)。如果不是，那么忽略要求。另外，发送(Sign, sid,m)给敌对放，在收到从敌对方收到(Signature, sid, m, )，验证没有条目(m, , v, 0)被记录。如果是，那么输出一个错误的信息给Ui,并且停止。此外，输出(Signature, sid, m, )给Ui,并且记录条目(m, , v, 0).

**签名验证** 在从利益相关者Ui收到一个信息(Verify, sid, m, , v0)，把(Verify, sid, m, , v0)交给敌对方。在从敌对方处收到(Verified, sid, m, )：

1. 如果v0 = v，并且条目(m, , v, 1)被记录，那么设置f = 1.（这个条件确保完整：如果验证密钥v0是登记的那个，是为m合理的生成的签名，那么验证成功）
2. 另外，如果v0 = v,签名者没有被夫八百，并且没有对于任何0的条目(m, 0, v, 1)被记录，那么设置f = 0，并且记录条目(m, , v, 0).（这个条件确保不可伪造性：如果v0是登记的那个，签名者不会被腐败，并且从不会签署m,那么验证失败）
3. 另外，如果有一个条目(m, , v0, f0)被记录，那么让f = f0.（这个条件确保一致性：所有的验证要求，带有完全相同的参数会导致相同的答案）
4. 另外，让f = ，并且记录条目(m, , v0, ).

输出(Verified, sid, m, f)给Ui.

第一，在图形3，我们展示了函数Fdsig,在【14】中被定义的，也被展示位EUF-CMA签名组合认识到Fdsig.注意这个事实会被用做去展示我们理想的协议可以实际的被认识到，基于实际的数字签名组合，比如DSA和 ECDSA），最后，iSPoS和SPoS.是不能区分。

理想的协议iSPoS被利益相关者运行，和FD,FLS [FDSIG] 与FDSIG相互作用。基本上，iSPoS作为SPoS来运转，除了条用Vrfvk() 和 Signsk(m).也就是说，不是本地计算Signski(m)，Ui发送(Sign, sid,m)给FDSIG,收到(Signature, sid, m, )并且输出作为签名。此外，不是本地计算Vrfvk0(,m)，Ui发送(Verify, sidi, m, , v0)给FDSIG（v0对应验证密钥vk0），输出在消息(Verified, sidi, m, f)中收到的值。协议iSPoS在图形4中被描述。理想的描述会被进一步的开发，当讨论动态的质押情况，额外的建立的区块必须在理想的协议里被考虑。

如下的名命题是一个结果的立即的推论，在展示,EUF-CMA签名组合意识到FDSIG

**命题 4.8** 对每个PPT A,Z它保持，那儿有一个PPT S，因此EXECP,FD,FLS [SIG]SPoS,A,Z ()和EXECP,FD,FLS [FDSIG]iSPoS,S,Z ()从计算方面讲是不能区分的

鉴于上述命题，在剩下的分析里我们会集中于这些性质。

In light of the above proposition in the remaining of the analysis we will focus on the properties

**协议**

is a protocol run by stakeholders

