**Compound**

**货币市场协议**

版本 1.0

二月 2019

作者

Robert Leshner, Geoffrey Hayes

https://compound.finance

**摘要**

在本文中，我们介绍一个去中心化的协议，基于供求在算法上设置利率的货币市场，允许用户无摩擦的交换以太坊资产的时间价值。

**内容**

**1. 介绍**

**2. Compound 协议**

2.1 提供资产

​    2.1.1 主要的使用情况

2.2 借入资产

​    2.2.1 抵押品价值

​    2.2.2 风险&流动性

​    2.2.3 主要的使用情况

2.3 理论模型

​    2.3.1 流动性激励结构

**3. 实施和架构**

3.1 cToken 合约

3.2 利率结构

​    3.2.1 市场动力学

​    3.2.2 借方动力学

3.3 借贷

3.4 流动性

3.5 喂价

3.6 审计官

3.7 治理

**总结**

**参考文献**

**1 介绍**

加密货币和数字区块链资产的市场已经发展为生机勃勃的包含投资者，投机者，交易者生态系统，交易数千种区块链资产。不幸地是，金融市场的复杂没有跟上：参与者几乎没有能力交易资产的时间价值。

利率填补了有不使用的剩余资产的人和没有资产的人（有一个生产性或投资性的用途）之间的缺口；交易资产的资产的时间价值对双方都有利，创造了非零和财富。对于区块链资产，现在存在两个主要的缺点：

- 接待机制及其有限，带来定错价格的资产（比如，“骗子币”带有高深莫测的价格，因为没有做空他们的方式）
- 区块链资产有负的收益，因为重大的存储成本和风险（包括链上和链下），没有自然的利率去抵消这些成本。这会带来易变性，因为没有对持有的激励

中心化的交易所（包括Bitfinex, Poloniex...）允许客户以保证金的形式交易区块链资产，用交易所内置的“借贷市场”。这些是基于信任的系统（你必须信任交易所不会被黑，带上你的资产潜逃，或者不正确的抛售你的仓位），被限制于特定的客户群体，也被限制于一小部分资产（最主流的）。最终余额和仓位是虚拟的；你不能在链上移动仓位，例如用借来的Ether或在一个智能合约或ICO内的tokens，使得这些设施难到达dApps

**2. Compound 协议**

Compound是基于Ethereum区块链的建立货币市场的协议，是一个资产池，在算法上产生利率，基于对资产的供求。一种资产的供应者（和借入者）直接基于协议交互，获得（和支付）一个浮动的利率，不需要和对方商议条款，比如到期日，利率或抵押品。

每个货币商场对于一个Ethereum资产是独特的（比如，Ether,一个ERC-20稳定比，比如DAI，或者一个ERC-20实用token,比如，Augur）,带有所有交易和历史利率的记录。

**2.1 提供的资产**

不像一个交易所或点对点的平台，一个用户的资产配对借给例外一个用户，Compound协议聚集每个用户的提供；当一个用户提供一个资产，就成为一个代替的资源。这个方式比直接借贷显著地提供更多的流动性。除非一个市场里的每个资产被借了（如下：协议激励流动性），用户可以在任何时间取回他们的资产，不需要等到一个特定的额借款到期。

提供到市场的资产被一个ERC-20token月代表（“cToken”）,使拥有者有一个基础资产的的增加数量。因为货币市场产生利率，是借贷需求的功能，cTokens成为可转为基础资产的增加量。在这个方式里，挣利息和持有ERC-20 cToken一样简单。

**2.1.1 主要使用情况**

长期投资Ether和tokens("HODLers")的个体可以用Compound市场作为获得他们投资额外的回报的来源。比如，一个拥有Augur的用户可以提供他们的tokens给Compounnd协议，可以在不需要管理他们自西汉，满足贷款要求或承担投机风险的情况下挣利息（以Augur命名）

有token余额的dApps,机器，和交易所可以使用Compound协议作为通过“挥动”余额获得货币化和增长的回报的来源；这有解锁完全的信的商业模式的潜力，对于Ethereum生态系统。

**2.2 借入资产**

Compound允许用户无摩擦的从协议借入，使用cTokens作为抵押品，可以在Ethereum生态系统任何地方使用。不像点对点的协议，从Compound借入仅仅需要一个用户去制定一个需要的资产；没有条款需要去上衣，到期日或融资期；借入是即时的和可预言的。和提供资产类似，每个货币市场有一个浮动的利率，有市场力量设置，决定每个资产的借贷成本。

**2.2.1 抵押品价值**

由协议持有的资产（由cToken的所有权代表）会被用作抵押品去从协议种借入。每个市场有一个抵押品系数，0~1，代表基础资产价值可被借入的比例。市场参与者少的，小盘的资产有较低的抵押品系数；他们不能做号的抵押品，当流动性，大盘资产有较高的抵押系数。账户基础token余额的价值总和，乘以抵押品系统，等于一个用户的借款能力。

用户可以最多借入他们的借款能力，但是不超过，一个账户能够不做任何操作（例如借入，转移cToken抵押品，或者赎回cToken抵押品）会提高超过他们借款能里的借入的资产的总价值；这将保护协议不会遭受违约风险。

**2.2.2 风险&流动性**

如果一个账户的借入未偿贷款超过他们的借款能力，未偿贷款的借款的一定比列会被偿还，通过交易用户的cToken的抵押品，基于当前市场价格减去一个流动性折扣；这激励从事套购活动的人的生态系统快速的进入去减少借款人的暴露，消除协议的风险。

比例合格者会被关闭，关闭系数，是可以用来偿还的借入资产的比例，从0到1，比如25%。流动性过程可能继续被调用，直到用户借款小于他们的借款能力。

任何拥有借入的资产的Ethereum地址可能调用流动性功能，用他们的资产交换解放的cToken的抵押品。作为两方用户，两方资产，价格全部包含在Compound协议种，流动性是无摩擦性的，不依赖于任何外在的系统或订单簿。

**2.2.3 主要的使用情况**

无缝地持有新资产的能力(不需要出售或者重新排列投资组合)给了dApp消费者，交易者，开发者新的超级强权：

- 不需要等到一个订单被填报，hi哦组需要链下行为，dApps能够借到在Ethereum生态系统中使用的tokens,比如在Golem网络中购买算力。
- 交易者可以给新的ICO投资投资，通过借入Ether,使用他们已有的投资组合作为抵押品
- 需要做空一个token的交易者可以借入它，发送到奥交易所，或者出售 token,从高估的tokens的降价中获利

**2.3 利率模型**

不是个人的需要商议条款和利率的提供者或者借入者，Compound使用一个利息模型，达到利率均衡，在每个货币市场，基于供求。基于经济理论，利率（货币的“价格”）必须作为需求的功能增长；当需要较低，利率也应该低，反之一样。为每个市场a使用利率U统一供求到一个单个变量：

Ua = Borrowsa / (Casha + Borrowsa)

需求曲线通过治理编纂，表达为一个使用函数。作为一个例子，借入利率可能像如下：

Borrowing Interest Ratea = 2.5% + Ua * 20%

提供者挣的利率是含蓄的，等于借入利率，乘以使用利率。

**2.3.1 流动性激励结构**

协议不保障流动性；反之，它依赖利率模型去激励它。在对一个资产有极端需求的时候，协议的流动性（可以取回或借入的token）会下降，当这个发生，利率上升，激励供给，抑制借入.

**3 实施和架构**

作为核心，Compound货币市场是一个账簿，允许Ethereum账户提供或借入资产，当计算利息，时间的功能。协议的智能合约公开地可进入，并且由及其，dApps和人类完全自由的使用。

**3.1 cToken合约**

每个货币市场作为一个只能合约来构架，实施ERC-20token规格。用户的余额以cToken余额代表；用户可以铸造(uint amountUnderlying) cTokens通过给市场提供资产，或者赎回(uint amount)基础资产的cTokens.cToken和基础资产之间的价格（兑换比率）随着时间而增加，作为由资产借入者产生的利率，等于

exchangeRate = cTokenSupplya
underlyingBalance +totalBorrowBalancea − reserves a

当市场总的借入余额增加（作为借入者利息产生的函数），cTokens和基础资产的汇率增加：

| Funtion ABI |  描述    |
| :-----------: | :----: |
| 铸造(uint256 amountUnderlying) | 转移一个基础资产到市场，更新msg.sender的cToken余额 |
| 赎回(uint256 amount)redeemUnderlying(uint256amountUnderlying) | 检查msg.send的抵押品价值，如果充足，从市场里转移基础资产到msg.sender,更新msg.sender的借入余额 |
| 偿还借款(uint amount)repayBorrowBehalf(addressaccount, uint amount) | 转移基础资产到市场里，更新借款者的借入余额 |
| 清算(address borrower,address collateralAsset, uintcloseAmount) | 转移基础资产到市场里，更新借入者的借入余额，然后将cToken抵押品从借入者转移到msg.sender |

表2：ABI和主要cToken智能合约的概括

**3.2 利率结构**

Compound货币市场有利率决定，一致地应用到所有借入者，随着供需关系，根据时间调整。

每个利率历史，对于每个货币市场，有利率索引捕获，每次利率变化时都会被计算，由用户铸造，赎回，借入，偿还或清算资产决定。

**3.2.1 动力学**

每次一笔交易发生，资产的利率索引会被更新去组合利息，从前面的索引，使用时期的利息，由r*t命名，使用每个区块利率计算：

Indexa,n = Indexa,(n−1) * (1 + r * t)

市场的总计的借入的未偿贷款更新到抱愧从上一个索引产生的利息：

totalBorrowBalancea,n = totalBorrowBalance a,(n−1) * (1 + r * t)

一定比例的产生的利息被作为储备金保留（流出），由reservefactor决定，从0到1：

reservesa = reserves a,(n−1) + totalBorrowBalancea,(n−1) * (r * t * reserveFactor)

**3.2.2 借方动力学**

借方的余额，包括产生的利息，仅仅时当前的索引除以所以的比例，当用户余额是最后检查的。

每个借方地址的余额在cToken被储藏为账户检查点。一个账户的检查点是一个坚固元组<uint256 balance, uint256 interestIndex>。这个元组描述利息最后应用到那个账户时的余额。

**3.3 借入**

一个想借入并且在Compound里存储足够的余额或许在相关的cToken合约上调用borrow(uint amount)。这个函数调用检查用户的账户金额，和给定的足够的抵押品，将更新用户的借入余额，转移tokens到用户的Ethereum地址，并且更新货币市场的浮动利率。

**3.4 清算**

如果一个用户的借入余额超过他们总计的抵押品价值（借入能力），由于抵押品的价值下降或借入资产价值增加，公共的函数liquidate(address target, address collateralAsset, address borrowAsset, uint
closeAmount)能被调用，交易唤起的用户的资产，用于借入人的抵押品，在一个稍好坏与市场价的价格。

**3.5  喂价**

价格语言及维持每个支持的资产的当前交易比率；Compound池把设置资产价格的能力授权给一个委员会，它的池子价格来自前10交易所。这些交易率会用来决定借款能力和抵押品要求，对于所有函数，需要计算一个账户的价值当量。

**3.6 审计官**

Compound协议不是默认支持特定的token;而是，市场必须是白名单的。这由一个管理函数完成，supportMarket(address market, address interest rate model)允许用户开始交互资产。为了使用一个资产作为抵押品，必须有一个有效的价格和一个抵押系数。

每个函数调用由策略层验证，指的是审计官，这个合约验证抵押品和清算，在允许用户行为进行之前。

**3.7 治理**

Compound开始是对协议的中心化控制（比如为每个资产选择利率），随着时间的过去，会过渡到完全的社区和利益相关者控制。协议中的如下权限由 管理者控制：

- 把一个新的cToken市场加入到正式的名单的能力
- 更新每个市场的利率模型的能力
- 更新预言机地址的能力
- 提取cToken储备金的能力
- 选择一个新的管理员的能力，比如一个由社区控制的DAO;因为DAO可以自己选择一个新的管理员，管理由能力随着时间进化，基于利益相关者的决定。

**4. 总结**

- Compound为Ethereum资产创造了合适的功能货币市场
- 每个货币市场有由基础资产的供需决定的利率；当借入资产的需求增加，或资产供应移除，利率增加，激励额外的流动性
- 用户可以在不信任一个中心方的情况下，提供tokens到货币市场挣利息
- 用户可以通过使用协议中的余额作为抵押品借入token(用来使用，出售，或再借)

**参考文献**

[1] Cryptocurrency Market Capitalizations. https://coinmarketcap.com/
[2] Bitfixex Margin Funding Guide. https://support.bitfinex.com/
[3] ETHLend White Paper. https://github.com/ETHLend
[4] Ripio White Paper. https://ripiocredit.network/
[5] Lendroid White Paper. https://lendroid.com/
[6] dYdX White Paper. https://whitepaper.dydx.exchange/
[7] Fred Ehrsam: The Decentralized Business Model. https://blog.coinbase.com/
8




